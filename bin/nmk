#!/bin/sh

nmk_dir=$(CDPATH= cd -- "$(dirname -- "$(dirname -- "$0")")" && pwd)

if [ -n "$NMK_ENTRYPOINT" ]; then
    exec "$NMK_ENTRYPOINT" "$@"
fi

if command -v nmk.go >/dev/null 2>&1; then
    exec nmk.go "$@"
fi

script=$nmk_dir/bin/nmk.py

for python in "$NMK_PYTHON" python3 python; do
    # Call binary to determine python existence
    # Check binary existence doesn't work because pyenv provide python shims.
    [ -n "$python" ] && "$python" --version > /dev/null 2>&1 && exec "$python" "$script" "$@"
done

>&2 echo "Error: Python not found"
exit 1
